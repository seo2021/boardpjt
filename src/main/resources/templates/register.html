<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- 문서 인코딩 설정 -->
    <meta charset="UTF-8">
    <!-- 반응형 웹 설정 -->
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <!-- Internet Explorer 호환성 설정 -->
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <!-- 페이지 제목 -->
    <title>StudyLog - 회원가입</title>

    <!-- Font Awesome 아이콘 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- 스타일시트 링크 -->
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- 헤더 -->
    <div th:replace="~{fragments/header :: header}"></div>

    <!-- 메인 콘텐츠 -->
    <main class="main-content">
        <!-- 회원가입 컨테이너 -->
        <div class="register-container">
            <!-- 회원가입 제목 -->
            <div class="register-header">
                <h1 class="register-title">회원가입</h1>
                <p class="register-subtitle">StudyLog와 함께 학습 여정을 시작하세요</p>
            </div>

            <!-- 에러 메시지 표시 영역 -->
            <div th:if="${error}" class="error-message">
                <i class="fas fa-exclamation-triangle"></i>
                <span th:text="${error}"></span>
            </div>

            <!-- 회원가입 폼 -->
            <form th:action="@{/auth/register}" method="post" class="register-form" id="registerForm">
                <!-- 사용자명 입력 필드 -->
                <div class="form-group">
                    <label for="username" class="form-label">
                        <i class="fas fa-user"></i>
                        사용자명
                    </label>
                    <input
                            type="text"
                            id="username"
                            name="username"
                            class="form-input"
                            placeholder="3-20자의 영문, 숫자 조합으로 입력해주세요"
                            required
                            minlength="3"
                            maxlength="20"
                    >
                    <div class="input-help">
                        <small>영문, 숫자 조합으로 3-20자 입력해주세요</small>
                    </div>
                </div>

                <!-- 비밀번호 입력 필드 -->
                <div class="form-group">
                    <label for="password" class="form-label">
                        <i class="fas fa-lock"></i>
                        비밀번호
                    </label>
                    <div class="password-input-wrapper">
                        <input
                                type="password"
                                id="password"
                                name="password"
                                class="form-input"
                                placeholder="8자 이상의 비밀번호를 입력해주세요"
                                required
                                minlength="8"
                        >
                        <button type="button" class="password-toggle" id="passwordToggle">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="input-help">
                        <small>8자 이상의 비밀번호를 입력해주세요</small>
                    </div>
                    <!-- 비밀번호 강도 표시 -->
                    <div class="password-strength" id="passwordStrength">
                        <div class="strength-meter">
                            <div class="strength-bar" id="strengthBar"></div>
                        </div>
                        <span class="strength-text" id="strengthText">비밀번호 강도</span>
                    </div>
                </div>

                <!-- 비밀번호 확인 필드 -->
                <div class="form-group">
                    <label for="passwordConfirm" class="form-label">
                        <i class="fas fa-lock"></i>
                        비밀번호 확인
                    </label>
                    <input
                            type="password"
                            id="passwordConfirm"
                            name="passwordConfirm"
                            class="form-input"
                            placeholder="비밀번호를 다시 입력해주세요"
                            required
                    >
                    <div class="password-match" id="passwordMatch"></div>
                </div>

                <!-- 이용약관 동의 -->
                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="agreeTerms" required>
                        <span class="checkbox-custom"></span>
                        <span class="checkbox-text">
                            <a href="#" class="terms-link">이용약관</a> 및
                            <a href="#" class="terms-link">개인정보 처리방침</a>에 동의합니다.
                        </span>
                    </label>
                </div>

                <!-- 회원가입 버튼 -->
                <button type="submit" class="register-button" id="registerButton">
                    <i class="fas fa-user-plus"></i>
                    계정 만들기
                </button>
            </form>

            <!-- 추가 링크 섹션 -->
            <div class="additional-links">
                <p class="link-text">이미 계정이 있으신가요?</p>
                <a href="/auth/login" class="login-link">
                    <i class="fas fa-sign-in-alt"></i>
                    로그인하기
                </a>
            </div>
        </div>
    </main>

    <!-- 푸터 -->
    <div th:replace="~{fragments/footer :: footer}"></div>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('registerForm');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const passwordConfirmInput = document.getElementById('passwordConfirm');
            const passwordToggle = document.getElementById('passwordToggle');
            const strengthBar = document.getElementById('strengthBar');
            const strengthText = document.getElementById('strengthText');
            const passwordMatch = document.getElementById('passwordMatch');
            const registerButton = document.getElementById('registerButton');

            // 비밀번호 보기/숨기기 토글
            passwordToggle.addEventListener('click', function() {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);

                const icon = this.querySelector('i');
                icon.classList.toggle('fa-eye');
                icon.classList.toggle('fa-eye-slash');
            });

            // 비밀번호 강도 검사
            passwordInput.addEventListener('input', function() {
                const password = this.value;
                let strength = 0;
                let strengthLabel = '';

                // 길이 체크
                if (password.length >= 8) strength++;
                if (password.length >= 12) strength++;

                // 문자 종류 체크
                if (/[a-z]/.test(password)) strength++;
                if (/[A-Z]/.test(password)) strength++;
                if (/[0-9]/.test(password)) strength++;
                if (/[^A-Za-z0-9]/.test(password)) strength++;

                // 강도 레이블 설정
                if (strength <= 2) {
                    strengthLabel = '약함';
                    strengthBar.className = 'strength-bar weak';
                    strengthBar.style.width = '25%';
                } else if (strength <= 4) {
                    strengthLabel = '보통';
                    strengthBar.className = 'strength-bar medium';
                    strengthBar.style.width = '50%';
                } else if (strength <= 5) {
                    strengthLabel = '강함';
                    strengthBar.className = 'strength-bar strong';
                    strengthBar.style.width = '75%';
                } else {
                    strengthLabel = '매우 강함';
                    strengthBar.className = 'strength-bar very-strong';
                    strengthBar.style.width = '100%';
                }

                strengthText.textContent = `비밀번호 강도: ${strengthLabel}`;
            });

            // 비밀번호 확인 검사
            function checkPasswordMatch() {
                const password = passwordInput.value;
                const confirm = passwordConfirmInput.value;

                if (confirm === '') {
                    passwordMatch.textContent = '';
                    passwordMatch.className = 'password-match';
                    return;
                }

                if (password === confirm) {
                    passwordMatch.textContent = '✓ 비밀번호가 일치합니다';
                    passwordMatch.className = 'password-match match';
                } else {
                    passwordMatch.textContent = '✗ 비밀번호가 일치하지 않습니다';
                    passwordMatch.className = 'password-match no-match';
                }
            }

            passwordInput.addEventListener('input', checkPasswordMatch);
            passwordConfirmInput.addEventListener('input', checkPasswordMatch);

            // 사용자명 유효성 검사
            usernameInput.addEventListener('input', function() {
                const value = this.value;
                const isValid = /^[a-zA-Z0-9]{3,20}$/.test(value);

                if (value.length > 0 && !isValid) {
                    this.classList.add('invalid');
                } else {
                    this.classList.remove('invalid');
                }
            });

            // 폼 제출 처리
            form.addEventListener('submit', function(e) {
                const username = usernameInput.value.trim();
                const password = passwordInput.value;
                const passwordConfirm = passwordConfirmInput.value;
                const agreeTerms = document.getElementById('agreeTerms').checked;

                // 유효성 검사
                if (!username || username.length < 3) {
                    alert('사용자명은 3자 이상 입력해야 합니다.');
                    e.preventDefault();
                    usernameInput.focus();
                    return;
                }

                if (!/^[a-zA-Z0-9]+$/.test(username)) {
                    alert('사용자명은 영문과 숫자만 사용할 수 있습니다.');
                    e.preventDefault();
                    usernameInput.focus();
                    return;
                }

                if (password.length < 8) {
                    alert('비밀번호는 8자 이상 입력해야 합니다.');
                    e.preventDefault();
                    passwordInput.focus();
                    return;
                }

                if (password !== passwordConfirm) {
                    alert('비밀번호가 일치하지 않습니다.');
                    e.preventDefault();
                    passwordConfirmInput.focus();
                    return;
                }

                if (!agreeTerms) {
                    alert('이용약관 및 개인정보 처리방침에 동의해야 합니다.');
                    e.preventDefault();
                    return;
                }

                // 로딩 상태 표시
                registerButton.classList.add('loading');
                registerButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 가입 중...';
                registerButton.disabled = true;
            });

            // 입력 필드 포커스 애니메이션
            const inputs = document.querySelectorAll('.form-input');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.parentElement.classList.add('focused');
                });

                input.addEventListener('blur', function() {
                    if (this.value === '') {
                        this.parentElement.classList.remove('focused');
                    }
                });
            });
        });
    </script>
</body>
</html>